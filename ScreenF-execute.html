<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>title</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        input {
            width: 100%;
        }
        
        button {
            border-radius: 0%;
            border: none;
        }
        
        h3,
        p {
            font-family: 'Courier New', Courier, monospace;
            color: white;
        }
        
        body {
            margin: 0;
            background-color: black;
        }
    </style>
</head>

<body>
    <div id="output">
        <input id="inputBox" value="Input your code">
        <button onclick="inputExecute()">Execute</button>
        <h3>Guide</h3>
        <p>Here is some special rule in ScreenF that's different than normal BrainF<br> - The first two cells are use to get the screen size (read only one at the first "," instruction)<br> - <code>,</code> (Comma character) are use to read 4 cells and output
            pixel as RBG color
        </p>
    </div>
    <script>
        function inputExecute() {
            data = document.getElementById('inputBox').value;
            console.log('Execute');
            document.getElementById('output').innerHTML = '<canvas id="outputCanvas"></canvas';
            runCode(data);
        }

        let arr = [0];
        let cur = 0;
        let render = false;

        function runCode(code) {
            let c = 0;
            for (let l1 = 0; l1 < code.length; l1++) {
                if (code[l1] == '[') {
                    c++
                } else if (code[l1] == ']') {
                    c--
                }
            }
            if (c != 0) throw "Missing [ or ]: " + c;

            for (let l1 = 0; l1 < code.length; l1++) {
                switch (code[l1]) {
                    case '>':
                        cur++;
                        if (!arr[cur]) arr[cur] = 0;
                        break;
                    case '<':
                        cur--;
                        if (cur < 0) throw `[${cur}] Out of arr range: cur < 0`
                        break;
                    case '+':
                        arr[cur]++;
                        break;
                    case '-':
                        arr[cur]--;
                        break;
                    case '.':
                        console.log(String.fromCharCode([arr[cur]]));
                        break;
                    case ',':

                        var canvas = document.getElementById("outputCanvas");
                        var ctx = canvas.getContext("2d");
                        if (!render) {
                            document.getElementById("outputCanvas").setAttribute('width', arr[0]);
                            document.getElementById("outputCanvas").setAttribute('height', arr[1])
                            render = true;
                        }
                        let cor = '';
                        for (let l2 = 1; l2 < 4; l2++) {
                            cor += (arr[cur + l2]) ? arr[cur + l2].toString(16) : '00';
                        }
                        ctx.fillStyle = '#' + cor;
                        ctx.fillRect(arr[cur], arr[cur + 1], arr[cur] + 100, arr[cur + 1] + 100);
                        console.log(arr[cur]);
                        break;
                    case '[':
                        let str = '';
                        let c = 1;
                        let l2 = 0;
                        for (; c != 0; l2++) {
                            if (code[l1 + 1 + l2] == '[') {
                                c++
                            } else if (code[l1 + 1 + l2] == ']') {
                                c--
                            };
                            str += code[l1 + 1 + l2];
                        }
                        while (arr[cur] != 0) {
                            runCode(str.substr(0, str.length - 1));
                        }
                        l1 += str.length;
                        break;
                }
            }
        }
    </script>
</body>
<html>
<!--
    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>
    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>
    ++++++++++>
    +++++++++>
    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>
    <<<<,
    
-->